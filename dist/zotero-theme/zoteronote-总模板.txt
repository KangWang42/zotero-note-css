<!-- author:wk-->



<h1 style="font-size: 1.4em; margin-bottom: 2em; margin-right: 5px; padding: 8px 15px;letter-spacing: 2px;color: #000000;border-left: 10px solid rgba(240, 19, 19, 0.5);background: rgba(240, 19, 19, 0.25); border-radius: 5px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2); box-shadow: 1px 1px 2px rgba(51, 51, 51, 0.5); text-align: center">${topItem.getField("title")}</h1>

${{// å‡è®¾ä» Zotero API è·å–çš„ HTML å…ƒç´ å­˜å‚¨åœ¨å˜é‡ element ä¸­
let element = Zotero.ZoteroStyle.api.renderCell(topItem, "readingTime");

// è·å–å…ƒç´ çš„æ–‡æœ¬å†…å®¹
let textContent = element.innerText;

// è¾“å‡ºæ–‡æœ¬å†…å®¹
return textContent
}}$

<table style="width:100%; border-collapse: collapse;">
  <tr>
    <td style="border: 1px solid black; min-width: 35%; padding: 8px; text-align: left;">æ ‡é¢˜ç¿»è¯‘</td>
    <td style="border: 1px solid black; padding: 8px;">${topItem.getField("titleTranslation")}</td>
  </tr>
  <tr>
    <td style="border: 1px solid black; min-width: 35%; padding: 8px; text-align: left;">ä½œè€…</td>
    <td style="border: 1px solid black; padding: 8px;">	${topItem.getCreators().map((v) => v.firstName + " " + v.lastName).join("; ")}</td>
  </tr>
  <tr>
    <td style="border: 1px solid black; min-width: 35%; padding: 8px; text-align: left;">å‡ºç‰ˆå¹´ä»½</td>
    <td style="border: 1px solid black; padding: 8px; text-align: center;">${topItem.getField('date')}</td>
  </tr>
  <tr>
    <td style="border: 1px solid black; min-width: 35%; padding: 8px; text-align: left;">æœŸåˆŠ</td>
    <td style="border: 1px solid black; padding: 8px; text-align: center;">${topItem.getField('publicationTitle')}</td>
  </tr>
  <tr>
    <td style="border: 1px solid black; min-width: 35%; padding: 8px; text-align: left;">æœŸåˆŠç­‰çº§</td>
    <td style="border: 1px solid black; padding: 8px; text-align: center;">${{let space = " ã…¤ã…¤ ã…¤ã…¤"
return Array.prototype.map.call(
	Zotero.ZoteroStyle.api.renderCell(topItem, "publicationTags").childNodes,
	e => {
		e.innerText =  space + e.innerText + space;
		return e.outerHTML
	}
	).join(space)
}}$</td>
</tr>
  <tr>
    <td style="border: 1px solid black; min-width: 35%; padding: 8px; text-align: center;">è®ºæ–‡æ ‡ç­¾</td>
    <td style="border: 1px solid black; text-align: center; padding: 8px;">${topItem.getTags().map(tagObj=>tagObj.tag)}</td>
  </tr>
  <tr>
    <td style="border: 1px solid black; padding: 8px; text-align: left;">é™„ä»¶é“¾æ¥</td>
    <td style="border: 1px solid black; padding: 8px;color:#4A148C">
    <a href=${{async function getPDFLink(item) {
    const att = await item.getBestAttachment();
    if (!att || !att.isPDFAttachment()) {
      return "";
    }
    key = att.key;
    if (att.libraryID === 1) {
      return `zotero://open-pdf/library/items/${key}`;
    } else {
      groupID = Zotero.Libraries.get(att.libraryID).id;
      return `zotero://open-pdf/groups/${groupID}/items/${key}`;
    }
  }
  sharedObj.getPDFLink = getPDFLink;
  return await getPDFLink(topItem);
}}$>
        ${topItem.getField("title")}
      </a>
    </td>
  </tr>
  <tr>
    <td style="border: 1px solid black; padding: 8px; text-align: left;">æ‘˜è¦</td>
    <td style="border: 1px solid black; padding: 8px;">${topItem.getField('abstractTranslation')}</td>
  </tr>
</table>

<hr/>
<h2 style='text-align:center'>ç›®å½•</h2>
<table style="text-align:center;width:100%; border-collapse: collapse; margin: 0 auto; background-color: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
  <tr>
    <td style="padding: 10px; background-color: #FFF8E1;"><a href="#back" style="text-decoration: none; color: black;">ğŸ“œ èƒŒæ™¯</a></td>
  </tr>
  <tr>
    <td style="padding: 10px; background-color: #F1F8E9;"><a href="#cont" style="text-decoration: none; color: black;">ğŸ”¬ ç ”ç©¶å†…å®¹</a></td>
  </tr>
  <tr>
    <td style="padding: 10px; background-color: #F5F5F5;"><a  href="#result" style="text-decoration: none; color: black;">ğŸš© ç ”ç©¶ç»“æœ</a></td>
  </tr>
  <tr>
    <td style="padding: 10px; background-color: #E0F7FA;"><a href="#creat" style="text-decoration: none; color: black;">ğŸ“Œ åˆ›æ–°ç‚¹</a></td>
  </tr>
  <tr>
    <td style="padding: 10px; background-color: #E1F5FE;"><a href="#other" style="text-decoration: none; color: black;">ğŸ”¬ å…¶å®ƒ</a></td>
  </tr>
  <tr>
    <td style="padding: 10px; background-color: #E1F5FE;"><a href="#anno" style="text-decoration: none; color: black;">ğŸ“Œ PDFæ³¨é‡Š</a></td>
  </tr>
</table>

<em style='font-size:7px;text-align:center!important;color:#9e9e9e;margin-top: 30px;'>ç‚¹å‡» Ctrl+å·¦é”® å³å¯è·³è½¬</em>



<br/>
<hr/>


<h2 id="back">ğŸ“œ èƒŒæ™¯</h2> 
<p ></p><hr/>
<h2 id="cont">ğŸ”¬ ç ”ç©¶å†…å®¹</h2> 
<p ></p><hr/>
<h2 id="result" >ğŸš© ç ”ç©¶ç»“æœ</h2> 
<p ></p><hr/>
<h2 id="creat">ğŸ“Œ åˆ›æ–°ç‚¹</h2>
<p ></p> <hr/>
<h2 id="other">ğŸ”¬ å…¶å®ƒ</h2> 
<p ></p> <hr/>
<h2 id="anno"> a ğŸ“ŒPDFæ³¨é‡Š</h2>
<p ></p>  
${{
  async function getAnnotationsByColor(_item, color) {
    const annots = _item
      .getAnnotations()
      .filter((item) => item.annotationColor === color);
    if (annots.length === 0) {
      return "";
    }
    return Zotero.BetterNotes.api.convert.annotations2html(annots, {
      noteItem: targetNoteItem,
    });
  }
  
  const attachments = Zotero.Items.get(topItem.getAttachments()).filter((i) =>
    i.isPDFAttachment()
  );
  
  let res = ``;
  
  const colors = {
    "#f9e196": "â­ çŸ¥è¯†-æœ‰è¶£çš„è§‚ç‚¹ã€äº‹å®ã€ä¾‹å­", // Yellow
    "#f0bbcb": "âš ï¸ é‡è¦çš„æ–¹æ³•", // Magenta
  };
  for (const attachment of attachments) {
    res += `ğŸ“„For Document:${attachment.attachmentFilename}`;
    for (const color in colors) {
      if (Object.hasOwnProperty.call(colors, color)) {
        const colorName = colors[color];
        const renderedAnnotations = await getAnnotationsByColor(
          attachment,
          color
        );
        if (renderedAnnotations) {
          res += `<h4><p style="background-color:${color};">${colorName}</h4></p>\n${renderedAnnotations}`;
        }
      }
    }
    const renderedAnnotations = await getAnnotationsByColor(
      attachment,
      (_annot) => !colors.includes(_annot.annotationColor)
    );
    if (renderedAnnotations) {
      res += `<h4><p>Other Annotations</p></h4>\n${renderedAnnotations}`;
    }
  }
  return res;
  }}$
  
  
  <hr />